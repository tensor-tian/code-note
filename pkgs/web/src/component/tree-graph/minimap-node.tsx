import React, { memo, useMemo } from "react";

import type { MiniMapNodeProps } from "reactflow";
import cls from "classnames";

const MiniMapNode = ({
  id,
  x,
  y,
  width,
  height,
  className,
  borderRadius,
  shapeRendering,
  onClick,
  selected,
}: MiniMapNodeProps) => {
  console.log("minimap node:", className);
  const isRoot = className.includes("root");
  const isSelected = className.includes("selected");
  const isGroup = className.includes("group");
  const fill = isGroup ? "#ffffffff" : isSelected ? "#60a5fa" : "#e2e8f0";
  const stroke = isGroup ? "#000" : "#fff";
  const strokeWidth = isGroup ? 10 : 0;
  return (
    <>
      <rect
        className={cls("react-flow__minimap-node", { selected }, className)}
        x={x}
        y={y}
        rx={borderRadius}
        ry={borderRadius}
        width={width}
        height={height}
        fill={fill}
        stroke={stroke}
        strokeWidth={strokeWidth}
        shapeRendering={shapeRendering}
        onClick={onClick ? (event) => onClick(event, id) : undefined}
      ></rect>
      {isRoot && <Root x={x} y={y} width={width} height={height} />}
    </>
  );
};

MiniMapNode.displayName = "MiniMapNode";

export default memo(MiniMapNode);

type TextProps = Pick<MiniMapNodeProps, "x" | "y" | "width" | "height">;

// https://danmarshall.github.io/google-font-to-svg-path/
// Ubuntu Sans Mono
function Root({ x, y, width, height }: TextProps) {
  const [xText, yText, wText, hText] = useMemo(() => {
    const r = width / height;
    if (r <= 2.969) {
      const xText = x + width * 0.1;
      const wText = width * 0.8;
      const hText = wText / 2.969;
      const yText = y + (height - hText) / 2;
      return [xText, yText, wText, hText];
    } else {
      const hText = height;
      const yText = y;
      const wText = hText * 2.969;
      const xText = x + (width - wText) / 2;
      return [xText, yText, wText, hText];
    }
  }, [x, y, width, height]);
  return (
    <svg
      x={xText}
      y={yText}
      width={wText}
      height={hText}
      viewBox="0 0 211.4 71.201"
      xmlns="http://www.w3.org/2000/svg"
    >
      <g
        id="svgGroup"
        strokeLinecap="round"
        fillRule="evenodd"
        fontSize="9pt"
        stroke="#000"
        strokeWidth="0.25mm"
        fill="#000"
      >
        <path
          d="M 7.9 70.001 L 0 70.001 L 0 1.701 A 23.284 23.284 0 0 1 2.295 1.105 Q 3.441 0.865 4.729 0.697 A 38.714 38.714 0 0 1 5.1 0.651 Q 8 0.301 11.05 0.151 Q 13.897 0.011 16.178 0.001 A 78.874 78.874 0 0 1 16.5 0.001 A 45.334 45.334 0 0 1 23.367 0.485 Q 26.928 1.033 29.783 2.197 A 18.753 18.753 0 0 1 35.2 5.501 Q 41.4 11.001 41.4 21.601 A 19.206 19.206 0 0 1 40.18 28.521 A 17.706 17.706 0 0 1 37.7 32.951 Q 34 37.801 28.4 40.601 A 187.263 187.263 0 0 1 30.141 43.348 Q 30.905 44.574 31.732 45.937 A 350.357 350.357 0 0 1 33.45 48.801 A 283.153 283.153 0 0 1 37.416 55.708 A 330.823 330.823 0 0 1 39.25 59.051 Q 42.2 64.501 44.7 70.001 L 36.2 70.001 Q 33.8 64.401 31.15 59.001 Q 28.5 53.601 25.8 49.151 A 69.22 69.22 0 0 0 23.817 46.059 Q 22.832 44.614 21.89 43.423 A 32.314 32.314 0 0 0 20.7 42.001 Q 20.172 42.076 19.133 42.123 A 52.89 52.89 0 0 1 18.4 42.151 Q 17.093 42.192 16.52 42.199 A 17.22 17.22 0 0 1 16.3 42.201 L 7.9 42.201 L 7.9 70.001 Z M 180.3 49.901 L 180.3 24.901 L 169.7 24.901 L 169.7 18.201 L 180.3 18.201 L 180.3 3.301 L 188.1 1.901 L 188.1 18.201 L 210.1 18.201 L 210.1 24.901 L 188.1 24.901 L 188.1 50.001 A 44.449 44.449 0 0 0 188.205 53.162 Q 188.439 56.442 189.2 58.551 A 8.594 8.594 0 0 0 190.281 60.651 A 6.541 6.541 0 0 0 192.85 62.801 A 10.889 10.889 0 0 0 195.009 63.532 Q 196.12 63.792 197.442 63.908 A 25.928 25.928 0 0 0 199.7 64.001 Q 203.609 64.001 205.942 63.285 A 10.196 10.196 0 0 0 206.05 63.251 Q 208.244 62.55 209.959 61.807 A 29.554 29.554 0 0 0 210.2 61.701 L 211.4 68.301 A 10.24 10.24 0 0 1 211.016 68.481 Q 210 68.935 207.4 69.951 A 15.8 15.8 0 0 1 204.719 70.712 Q 203.33 70.987 201.694 71.107 A 36.843 36.843 0 0 1 199 71.201 Q 190.9 71.201 186.9 68.551 Q 182.9 65.901 181.6 61.101 A 35.193 35.193 0 0 1 180.667 56.249 Q 180.3 53.301 180.3 49.901 Z M 69.995 69.857 A 22.156 22.156 0 0 0 77.5 71.101 A 26.356 26.356 0 0 0 79.382 71.034 A 21.429 21.429 0 0 0 89.55 67.751 A 21.794 21.794 0 0 0 93.313 64.717 A 24.25 24.25 0 0 0 97.8 58.351 A 27.845 27.845 0 0 0 100.184 51.09 A 37.792 37.792 0 0 0 100.8 44.101 A 38.217 38.217 0 0 0 100.266 37.565 A 28.067 28.067 0 0 0 97.8 29.851 A 27.653 27.653 0 0 0 97.117 28.559 A 22.948 22.948 0 0 0 89.55 20.401 A 20.587 20.587 0 0 0 84.844 18.137 A 23.109 23.109 0 0 0 77.5 17.001 A 25.249 25.249 0 0 0 76.884 17.008 A 20.954 20.954 0 0 0 65.7 20.401 A 21.937 21.937 0 0 0 61.981 23.461 A 24.379 24.379 0 0 0 57.55 29.851 A 28.176 28.176 0 0 0 55.206 37.111 A 38.415 38.415 0 0 0 54.6 44.101 A 38.217 38.217 0 0 0 55.134 50.637 A 28.067 28.067 0 0 0 57.6 58.351 A 27.721 27.721 0 0 0 58.642 60.263 A 22.604 22.604 0 0 0 65.75 67.751 A 20.252 20.252 0 0 0 69.995 69.857 Z M 125.995 69.857 A 22.156 22.156 0 0 0 133.5 71.101 A 26.356 26.356 0 0 0 135.382 71.034 A 21.429 21.429 0 0 0 145.55 67.751 A 21.794 21.794 0 0 0 149.313 64.717 A 24.25 24.25 0 0 0 153.8 58.351 A 27.845 27.845 0 0 0 156.184 51.09 A 37.792 37.792 0 0 0 156.8 44.101 A 38.217 38.217 0 0 0 156.266 37.565 A 28.067 28.067 0 0 0 153.8 29.851 A 27.653 27.653 0 0 0 153.117 28.559 A 22.948 22.948 0 0 0 145.55 20.401 A 20.587 20.587 0 0 0 140.844 18.137 A 23.109 23.109 0 0 0 133.5 17.001 A 25.249 25.249 0 0 0 132.884 17.008 A 20.954 20.954 0 0 0 121.7 20.401 A 21.937 21.937 0 0 0 117.981 23.461 A 24.379 24.379 0 0 0 113.55 29.851 A 28.176 28.176 0 0 0 111.206 37.111 A 38.415 38.415 0 0 0 110.6 44.101 A 38.217 38.217 0 0 0 111.134 50.637 A 28.067 28.067 0 0 0 113.6 58.351 A 27.721 27.721 0 0 0 114.642 60.263 A 22.604 22.604 0 0 0 121.75 67.751 A 20.252 20.252 0 0 0 125.995 69.857 Z M 77.6 63.901 Q 82.1 63.901 85.5 61.551 A 14.152 14.152 0 0 0 89.429 57.386 A 18.721 18.721 0 0 0 90.8 54.751 Q 92.566 50.614 92.691 44.964 A 39.278 39.278 0 0 0 92.7 44.101 A 33.992 33.992 0 0 0 92.349 39.086 Q 91.884 35.967 90.8 33.401 A 17.838 17.838 0 0 0 88.678 29.643 A 13.995 13.995 0 0 0 85.45 26.501 A 13.448 13.448 0 0 0 78.093 24.111 A 16.495 16.495 0 0 0 77.5 24.101 A 13.641 13.641 0 0 0 72.645 24.947 A 12.58 12.58 0 0 0 69.75 26.501 A 14.146 14.146 0 0 0 65.999 30.555 A 18.87 18.87 0 0 0 64.55 33.401 Q 62.817 37.617 62.707 43.326 A 40.495 40.495 0 0 0 62.7 44.101 Q 62.7 49.713 64.257 53.891 A 19.745 19.745 0 0 0 64.6 54.751 A 17.803 17.803 0 0 0 66.67 58.407 A 13.793 13.793 0 0 0 69.9 61.551 Q 73.3 63.901 77.6 63.901 Z M 133.6 63.901 Q 138.1 63.901 141.5 61.551 A 14.152 14.152 0 0 0 145.429 57.386 A 18.721 18.721 0 0 0 146.8 54.751 Q 148.566 50.614 148.691 44.964 A 39.278 39.278 0 0 0 148.7 44.101 A 33.992 33.992 0 0 0 148.349 39.086 Q 147.884 35.967 146.8 33.401 A 17.838 17.838 0 0 0 144.678 29.643 A 13.995 13.995 0 0 0 141.45 26.501 A 13.448 13.448 0 0 0 134.093 24.111 A 16.495 16.495 0 0 0 133.5 24.101 A 13.641 13.641 0 0 0 128.645 24.947 A 12.58 12.58 0 0 0 125.75 26.501 A 14.146 14.146 0 0 0 121.999 30.555 A 18.87 18.87 0 0 0 120.55 33.401 Q 118.817 37.617 118.707 43.326 A 40.495 40.495 0 0 0 118.7 44.101 Q 118.7 49.713 120.257 53.891 A 19.745 19.745 0 0 0 120.6 54.751 A 17.803 17.803 0 0 0 122.67 58.407 A 13.793 13.793 0 0 0 125.9 61.551 Q 129.3 63.901 133.6 63.901 Z M 7.9 7.101 L 7.9 35.701 L 14.7 35.701 Q 19.717 35.701 23.652 34.827 A 28.98 28.98 0 0 0 24.4 34.651 Q 28.6 33.601 31 30.451 Q 33.4 27.301 33.4 21.101 Q 33.4 17.375 32.532 14.787 A 9.841 9.841 0 0 0 31.15 12.051 Q 28.9 9.001 25.3 7.901 A 25.57 25.57 0 0 0 19.12 6.839 A 29.56 29.56 0 0 0 17.6 6.801 Q 14.4 6.801 11.65 6.851 A 65.893 65.893 0 0 0 10.457 6.882 Q 8.666 6.948 7.9 7.101 Z"
          vectorEffect="non-scaling-stroke"
        />
      </g>
    </svg>
  );
}
